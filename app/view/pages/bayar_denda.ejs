<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Digi Perpus</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- IonIcons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
  <link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="plugins/toastr/toastr.min.css">
  <!-- BATASSSS -->
  <!-- <link rel="stylesheet" href="assets/css/bootstrap.min.css">
 <link rel="stylesheet" href="assets/css/ilmudetil.css">
 <link rel="stylesheet" href="assets/css/bootstrap-datetimepicker.css"/>
 <script src="assets/js/bootstrap.min.js"></script>
 <script src="assets/js/moment-with-locales.js"></script>
 <script src="assets/js/jquery-1.11.3.min.js"></script>
 <script src="assets/js/bootstrap-datetimepicker.js"></script> -->
</head>
<!--
`body` tag options:

  Apply one or more of the following classes to to the body tag
  to get the desired effect

  * sidebar-collapse
  * sidebar-mini
-->

<body class="hold-transition sidebar-mini">
  <div class="wrapper">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
        
        <li class="nav-item dropdown">
          
      </ul>
      <ul class="navbar-nav ml-auto">
        <li class="nav-item dropdown">
          <a class="nav-link" data-toggle="dropdown" href="#">
            <i class="far fa-user-circle"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
            <!-- <a href="/profil" class="dropdown-item">
              <i class="fas fa-user mr-2"></i> Profil
            </a> -->
            <div class="dropdown-divider"></div>
            <a href="/ubah_password" class="dropdown-item">
              <i class="fas fa-lock mr-2"></i> Ubah Password
            </a>
            <div class="dropdown-divider"></div>
            <a href="/logout" class="dropdown-item" onclick="logout()">
              <i class="fas fa-sign-out-alt mr-2"></i> Logout
            </a>
          </div>
        </li>
      </ul>
      
    </nav>
    <!-- /.navbar -->

    

    <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
      <!-- Brand Logo -->
      <a href="/beranda" class="brand-link">
        <img src="dist/img/book1.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
          style="opacity: .8">
        <span class="brand-text font-weight-light">Digi Perpus</span>
      </a>

      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Sidebar user panel (optional) -->
        <div class="user-panel mt-3 pb-3 mb-3 d-flex">
          <div class="image">
            <img src="dist/img/pngegg (1).jpg" class="img-circle elevation-2" alt="User Image">
          </div>
          <div class="info" id="user">
            <!-- <a href="/profil" class="d-block"></a> -->
          </div>
        </div>

        <!-- SidebarSearch Form -->
        <!-- <div class="form-inline">
        <div class="input-group" data-widget="sidebar-search">
          <input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
          <div class="input-group-append">
            <button class="btn btn-sidebar">
              <i class="fas fa-search fa-fw"></i>
            </button>
          </div>
        </div>
      </div> -->

        <!-- Sidebar Menu -->
        <nav class="mt-2">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
            <!-- Add icons to the links using the .nav-icon class
                 with font-awesome or any other icon font library -->
            <li class="nav-item">
              <a href="/beranda" class="nav-link">
                <i class="nav-icon fas fa-tachometer-alt"></i>
                <p>
                  Beranda
                  <!-- <i class="right fas fa-angle-left"></i> -->
                </p>
              </a>
            </li>
            <!-- menu-poen untuk buka -->
            <li class="nav-item">
              <!-- acctive untuk select -->
              <a href="#" class="nav-link">
                <i class="nav-icon fas fa-users"></i>
                <p>
                  Anggota
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>

              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="anggota_input" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Input</p>
                  </a>
                </li>

                <li class="nav-item">
                  <!-- acctive untuk select -->
                  <a href="anggota_laporan" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Laporan</p>
                  </a>
                </li>

              </ul>
            </li>

            <li class="nav-item">
              <a href="#" class="nav-link">
                <i class="nav-icon fas fa-book"></i>
                <p>
                  Data Buku
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="/buku_input" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Input</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="/Buku_daftar" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Daftar Buku</p>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link">
                <i class="nav-icon fas fa-th-large"></i>
                <p>
                  Kategori
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="/kategori" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Input</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="/lap_kategori" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Laporan</p>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a href="/penerbit_input" class="nav-link">
                <i class="nav-icon fas fa-landmark"></i>
                <p>
                  Penerbit
                </p>
              </a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link">
                <i class="nav-icon fas fa-arrow-right"></i>
                <p>
                  Pemasukan Buku
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="/pemasukan_input" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Input</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="/pemasukan_laporan" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Laporan</p>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link ">
                <i class="nav-icon fas fa-arrow-left"></i>
                <p>
                  Pengeluaran Buku
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="/pengeluaran_input" class="nav-link ">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Input</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="/pengeluaran_laporan" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Laporan</p>
                  </a>
                </li>

              </ul>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link">
                <i class="nav-icon fas fa-book-open"></i>
                <p>
                  Peminjaman Buku
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="/peminjaman_input" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Input</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="/peminjaman_laporan" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Laporan</p>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link">
                <i class="nav-icon fas fa-book-open"></i>
                <p>
                  Pengembalian Buku
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="/pengembalian_input" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Input</p>
                  </a>
                </li>

                <li class="nav-item">
                  <a href="/pengembalian_laporan" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Laporan</p>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a href="/history" class="nav-link">
                <i class="nav-icon fas fa-clock"></i>
                <p>
                  History
                </p>
              </a>
            </li>
            <li class="nav-item">
              <a href="/buku_pinjam" class="nav-link">
                <i class="nav-icon fas fa-list"></i>
                <p>
                  Buku Yang Dipinjam
                </p>
              </a>
            </li>
            <li class="nav-item menu-open">
              <a href="#" class="nav-link active">
                <i class="nav-icon fas fa-coins"></i>
                <p>
                  Denda
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="/denda" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Laporan Denda</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="/bayar_denda" class="nav-link active">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Pembayaran Denda</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="/laporan_bayar" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Laporan Pembayaran</p>
                  </a>
                </ul>
                </li>

            <li class="nav-item">
              <a href="/konfigurasi" class="nav-link">
                <i class="nav-icon fas fa-wrench"></i>
                <p>
                  Konfigurasi
                </p>
              </a>
            </li>
            <li class="nav-item">
              <a href="/input_user" class="nav-link">
                <i class="fas fa-user-edit nav-icon"></i>
              <p>
                  Input User
                </p>
              </a>
            </li>

          </ul>
        </nav>
        <!-- /.sidebar-menu -->
      </div>
      <!-- /.sidebar -->
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <div class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1 class="m-0">PEMBAYARAN DENDA</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <li class="breadcrumb-item"><a href="/beranda">Beranda</a></li>
                <li class="breadcrumb-item active">Pembayaran Denda</li>
              </ol>
            </div><!-- /.col -->
          </div><!-- /.row -->
        </div><!-- /.container-fluid -->
      </div>
      <!-- /.content-header -->

      <!-- Main content  -->
      <div class="content">
        <div class="container-fluid">

          <div class="row">
            <div class="col-lg">
            <div class="card">
              <div id="table_bayar"></div>
              <!-- Tambah konten di sini -->
              <div class="modal fade" id="bayar">
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h4>
                        <i class="nav-icon fas fa-plus"></i>
                        Bayar Denda
                      </h4>
                    </div>
                    <div class="modal-body">
                      <div class="row mb-2">
                        <div class="form-group col-md-6">
                          <label>Nomor Pinjam</label>
                          <input type="text" name="nopin" class="form-control" id="nopin" placeholder="Nomor Pinjam" disabled>
                        </div>
                        <div class="form-group col-md-6">
                          <label>Tanggal Bayar</label>
                          <input type="date" name="tanggal" class="form-control" id="tg_bayar" placeholder="Tanggal Bayar">
                        </div>  
                    <div class="form-group col-md-6">
                      <label>Keterlambatan (hari)</label>
                      <input type="text" name="telat" class="form-control" id="telat" placeholder="Keterlambatan" disabled>
                    </div>
                    <div class="form-group col-md-6">
                      <label>Denda</label>
                      <input type="text" name="denda" class="form-control" id="denda" placeholder="Denda" disabled>
                    </div>  
                    <div class="form-group col-md-6">
                      <label>Jumlah Bayar</label>
                      <input type="text" name="jumlah" class="form-control" id="jumlah" placeholder="Jumlah Bayar" disabled>
                    </div>  
                    
                  </div>
                  <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-default" data-dismiss="modal" onclick="kosong_n_bayar()">Tutup</button>
                    <button type="button" class="btn btn-primary" onclick="simpan_bayar(window.n_bayar)">Simpan</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
            </div>
          </div>
        </div>
    </div>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->

  <!-- Main Footer >
  <footer class="main-footer">
    <strong>Copyright &copy; 2014-2021 <a href="https://adminlte.io">AdminLTE.io</a>.</strong>
    All rights reserved.
    <div class="float-right d-none d-sm-inline-block">
      <b>Version</b> 3.1.0
    </div>
  </footer>
  </div>
  <!-- ./wrapper -->

  <!-- REQUIRED SCRIPTS -->

  <!-- jQuery -->
  <script src="plugins/jquery/jquery.min.js"></script>
  <!-- Bootstrap -->
  <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <!-- AdminLTE -->
  <script src="dist/js/adminlte.js"></script>
  
  <!-- OPTIONAL SCRIPTS -->
  <script src="plugins/chart.js/Chart.min.js"></script>
  <script src="plugins/toastr/toastr.min.js"></script>

  <!-- AdminLTE for demo purposes -->
  <!-- <script src="dist/js/demo.js"></script> -->
  <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
  <script src="dist/js/pages/dashboard3.js"></script>
  <!-- JAVASCRIPT RUPIAH -->
  <script src="js/pemisah_ribuan.js"></script>
 
  <script>

  user= '<%= session["nama"] %>'
  
  bayar1()
    if(user=="") window.location="/login"
  
    document.getElementById("user").innerHTML=`<a href="#" class="d-block">${user} </a>`

    function kosong_n_bayar(){
        window.n_bayar=0
       
      }
      function bayar1() {
              $.ajax({
                url: '/bayar1',
                method: "post",
                dataType: "json",
                data: {},
                success: function (hasil) {
                  vdata = []
                
                  for(data of hasil){

                 if ( data.telat < 0 ){
                  data.telat=0
                 }
                }
                 
                  for (kolom of hasil) {
                    aksi = `
                        <div class="project-action">
                            <button type="button" class="btn btn-warning btn-sm" data-toggle="modal" data-target="#bayar" onclick="tampil_bayar(${kolom.n_pinjam})">
                              <i class="fas fa-pencil-alt">
                              </i>  
                              Bayar
                            </button>
                             </div>
                            `  
                      isi_table = []
                      isi_table.push(kolom.n_pinjam,kolom.nama,kolom.tg_pinjam, kolom.tgl_kembali,kolom.telat,pemisah_ribuan(kolom.denda*kolom.telat),gridjs.html(aksi))
                       vdata.push(isi_table)
                  }
        
                  new gridjs.Grid({
                    columns: ["Nomor Pinjam","Nama Peminjam","Tanggal Pinjam","Tanggal Kembali","Keterlambatan (hari)","Denda",""],
                    data: vdata,
                    pagination: {
                      enabled: true,
                      limit: 6
                    },
                    search: true,
              language: {
                search: {
                  placeholder: "Cari"
                },
              'pagination': {
                'previous': 'Sebelumnya',
                'next': 'Selanjutnya',
                'showing': 'Menampilkan',
                'results': 'Hasil',
                'to':'Sampai',
                'of':'Dari'

                  
                }
              }
                  }).render(document.getElementById("table_bayar"));
                
                
                },
                error: function (hasil) {
                  toastr.error(hasil.responseText)
                }
              })
            }
           
          function simpan_bayar(n_bayar){
            $.ajax({
              url: '/simpan_bayar',
              method: "POST",
              dataType: "JSON",
              data: {
              n_pinjam : document.getElementById("nopin").value,
              tg_bayar : document.getElementById("tg_bayar").value,
              hari_telat : document.getElementById("telat").value,
              denda_hari : document.getElementById("denda").value,
              nilai : document.getElementById("jumlah").value,
              "n_bayar" :n_bayar
              },
              success: function (hasil) {
              
                toastr.success('Berhasil simpan')
              
                setTimeout(()=>{
                  window.location.reload();
                },1000)
                
                
              },
            
              error: function (hasil) {
                toastr.error(hasil.responseText)
              }
          })
        }


        function  tampil_bayar(n_bayar) {
          window.n_bayar=n_bayar
          $.ajax({
            url: '/tampil_bayar',
            method: "post",
            dataType: "JSON",
            data: {
             
              "n_pinjam" :n_bayar
            },
            success: function (hasil) {
              document.getElementById("nopin").value=hasil.data[0].n_pinjam
              document.getElementById("telat").value=hasil.data[0].telat
              document.getElementById("denda").value=hasil.data[0].denda
              document.getElementById("jumlah").value=hasil.data[0].telat*hasil.data[0].denda
            
            },
          
            error: function (hasil) {
              toastr.error(hasil.responseText)
            
            }
        })
        }

          
        function logout() {
    
          $.ajax({
            url:"/logout",
            method: "get",
            dataType: "json",
            data :{ },
            success: function (results) {
              window.location = '/login'
            },
            error : function(hasil){
              toastr.error(hasil.responseText)
            }
          })
        }
  
</script>
</body>

</html>
