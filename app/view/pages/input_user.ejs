<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>input user</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- IonIcons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
  <link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="plugins/toastr/toastr.min.css">
  <link rel="stylesheet" href="css/style.css">


</head>
<body class="hold-transition sidebar-mini">
<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </ul>
    </li>
  
    <ul class="navbar-nav ml-auto">
      <li class="nav-item dropdown">
        <a class="nav-link" data-toggle="dropdown" href="#">
          <i class="far fa-user-circle"></i>
        </a>
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
          
          <div class="dropdown-divider"></div>
          <a href="/ubah_password" class="dropdown-item">
            <i class="fas fa-lock mr-2"></i> Ubah Password
          </a>
          <div class="dropdown-divider"></div>
          <a href="/logout" class="dropdown-item" onclick="logout()">
            <i class="fas fa-sign-out-alt mr-2"></i> Logout
          </a>
        </div>
      </li>
    </ul>

    
  <!-- </li> -->
</nav>
  
  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="/beranda" class="brand-link">
      <img src="dist/img/book1.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
        style="opacity: .8">
      <span class="brand-text font-weight-light">Digi Perpus</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Sidebar user panel (optional) -->
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="image">
          <img src="dist/img/pngegg (1).jpg" class="img-circle elevation-2" alt="User Image">
        </div>
        <div class="info" id="user">
         
        </div>
      </div>

      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <li class="nav-item">
            <a href="/beranda" class="nav-link ">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p>
                Beranda
                
              </p>
            </a>
          </li>
          <!-- menu-open untuk buka -->
          <li class="nav-item ">
            <!-- acctive untuk select -->
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-users"></i>
              <p>
                Anggota
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>

            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="anggota_input" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Input</p>
                </a>
              </li>

              <li class="nav-item">
                <!-- acctive untuk select -->
                <a href="anggota_laporan" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Laporan</p>
                </a>
              </li>

            </ul>
          </li>

          <li class="nav-item">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-book"></i>
              <p>
                Data Buku
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="/buku_input" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Input</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/Buku_daftar" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Daftar Buku</p>
                </a>
              </li>
            </ul>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-th-large"></i>
              <p>
                Kategori
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="/kategori" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Input</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/lap_kategori" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Laporan</p>
                </a>
              </li>
            </ul>
          </li>
          <li class="nav-item">
            <a href="/penerbit_input" class="nav-link">
              <i class="nav-icon fas fa-landmark"></i>
              <p>
                Penerbit
              </p>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-arrow-right"></i>
              <p>
                Pemasukan Buku
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="/pemasukan_input" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Input</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/pemasukan_laporan" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Laporan</p>
                </a>
              </li>
            </ul>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link ">
              <i class="nav-icon fas fa-arrow-left"></i>
              <p>
                Pengeluaran Buku
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="/pengeluaran_input" class="nav-link ">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Input</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/pengeluaran_laporan" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Laporan</p>
                </a>
              </li>

            </ul>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-book-open"></i>
              <p>
                Peminjaman Buku
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="/peminjaman_input" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Input</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/peminjaman_laporan" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Laporan</p>
                </a>
              </li>
            </ul>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-book-open"></i>
              <p>
                Pengembalian Buku
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="/pengembalian_input" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Input</p>
                </a>
              </li>

              <li class="nav-item">
                <a href="/pengembalian_laporan" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Laporan</p>
                </a>
              </li>
            </ul>
          </li>
          <li class="nav-item">
            <a href="/history" class="nav-link">
              <i class="nav-icon fas fa-clock"></i>
              <p>
                History
              </p>
            </a>
          </li>
          
          <li class="nav-item">
            <a href="/buku_pinjam" class="nav-link">
              <i class="nav-icon fas fa-list"></i>
              <p>
                Buku Yang Dipinjam
                
              </p>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-coins"></i>
              <p>
                Denda
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="/denda" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Laporan Denda</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/bayar_denda" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Pembayaran Denda</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/laporan_bayar" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Laporan Pembayaran</p>
                </a>
              </ul>
              </li>
          <li class="nav-item">
            <a href="/konfigurasi" class="nav-link">
              <i class="nav-icon fas fa-wrench"></i>
              <p>
                Konfigurasi
              
              </p>
            </a>
          </li>
          <li class="nav-item menu-open">
            <a href="/input_user" class="nav-link active">
              <i class="nav-icon fas fa-user-edit"></i>
            <p>
                Input User
                
              </p>
            </a>
          </li>
        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0">UBAH USER</h1>
          </div><!-- /.col -->
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="/beranda">Beranda</a></li>
              <li class="breadcrumb-item active">Ubah User</li>
            </ol>
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
  <!-- Content Wrapper. Contains page content -->

    <!-- Main content -->
   <div class="content">
      <div class="container-fluid">
        <div class="row">
          <!-- <div class="card">
            <div id="table_user1"></div> -->
          <!-- left column -->
          <div class="col-md-12">
            <!-- jquery validation -->
            <div class="card card-primary">
              <div class="card-header">
                <h3 class="card-title">BUAT USER BARU<small>   Disini</small></h3>
                
              </div>
        
              <!-- /.card-header -->
              <!-- form start -->
              <form  method="post" id="userr">
                <div class="card-body">
                    <div class="form-group">
                        <label for="exampleInputnama">Nama</label>
                        <input type="text" name="nama" class="form-control" id="nama" placeholder="Nama">
                      </div>
                      <div class="form-group">
                        <label for="exampleInputusername">Username</label>
                        <input type="text" name="username" class="form-control" id="username" placeholder="Username">
                      </div>
                  <div class="form-group">
                    <label for="exampleInputPassword1">Password </label>
                    <input type="password" name="password" class="form-control" id="password" placeholder="Password Baru"  pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters" required >
                  </div>
                  <div class="form-group">
                    <label for="exampleInputPassword2">Konfirmasi Password </label>
                    <input type="password" name="password" class="form-control" id="konfirmasi" placeholder="Konfirmasi Password" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters" required >
                  </div>
                  <div id="message">
                    <b>Password harus terdiri dari: </b>
                    <hr>
                      <p id="letter" class="invalid" style="line-height: 1px"><b>Memiliki huruf kecil</b></p>
                      <p id="capital" class="invalid" style="line-height: 1px"><b>Memiliki huruf besar</b></p>
                      <p id="number" class="invalid" style="line-height: 1px"><b>Memiliki nomor</b></p>
                      <p id="length" class="invalid" style="line-height: 1px"><b>Memiliki 8 karakter</b></p>
                  </div>
                </div>
                <div class="modal-footer justify-content-between">
                  <button type="button" class="btn btn-default" data-dismiss="modal" onclick="kosong_id_user(0)">Batal</button>
                  <button type="button" class="btn btn-primary" onclick="simpan_user(window.userbaru)">Simpan</button>
                </div>
              </div>
            </div> 
          </div>
          </form>
             
              <div id="table_user"></div>
              <div class="modal fade" id="notif">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h4>
                        <i class="fas fa-info-circle"></i>
                        Peringatan!!
                      </h4>
                    </div>
                    <div class="modal-body">
                      <div class="form-group text-center">
                        <label>yakin hapus data?</label>            
                      </div>
                    </div>
                      
            <div class="modal-footer justify-content-between">
              <button type="button" class="btn btn-default" data-dismiss="modal" onclick="kosong_id_hapus()">Tidak</button>
              <button type="button" class="btn btn-primary" onclick="hapus_user(window.id_hapus)">Ya</button>  
              </div>
            </div>
            <!-- /.card -->
            </div>
          <!--/.col (left) -->
          <!-- right column -->
          <!-- <div class="col-md-6">

          </div> -->
          <!--/.col (right) -->
        </div>
        <!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content -->
  </div>
</div>
</div>
  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->

<!-- ./wrapper -->

<!-- jQuery -->
<script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
    <script src="plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- AdminLTE -->
    <script src="dist/js/adminlte.js"></script>
    <!-- validasi -->
    <script src="../../plugins/jquery-validation/jquery.validate.min.js"></script>
    <script src="../../plugins/jquery-validation/additional-methods.min.js"></script>
    <!-- OPTIONAL SCRIPTS -->
    <script src="plugins/chart.js/Chart.min.js"></script>
    <script src="plugins/toastr/toastr.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <!-- <script src="dist/js/demo.js"></script> -->
    <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
    <script src="dist/js/pages/dashboard3.js"></script>

<script>
const myInput = document.getElementById("password");
let letter = document.getElementById("letter");
let capital = document.getElementById("capital");
let number = document.getElementById("number");
let length = document.getElementById("length");

// When the user clicks on the password field, show the message box

myInput.onfocus = function() {
    document.getElementById("message").style.display = "block";
}
myInput.onblur = function() {
    document.getElementById("message").style.display = "none";
}
myInput.onkeyup = function() {
  // Validate lowercase letters
  var lowerCaseLetters = /[a-z]/g;
  if(myInput.value.match(lowerCaseLetters)) {  
    letter.classList.remove("invalid");
    letter.classList.add("valid");
  } else {
    letter.classList.remove("valid");
    letter.classList.add("invalid");
  }
  
  // Validate capital letters
  var upperCaseLetters = /[A-Z]/g;
  if(myInput.value.match(upperCaseLetters)) {  
    capital.classList.remove("invalid");
    capital.classList.add("valid");
  } else {
    capital.classList.remove("valid");
    capital.classList.add("invalid");
  }
  // Validate numbers
  var numbers = /[0-9]/g;
  if(myInput.value.match(numbers)) {  
    number.classList.remove("invalid");
    number.classList.add("valid");
  } else {
    number.classList.remove("valid");
    number.classList.add("invalid");
  }
  
  // Validate length
  if(myInput.value.length >= 8) {
    length.classList.remove("invalid");
    length.classList.add("valid");
  } else {
    length.classList.remove("valid");
    length.classList.add("invalid");
  }
}

const Input = document.getElementById("konfirmasi");
 letter = document.getElementById("letter");
 capital = document.getElementById("capital");
 number = document.getElementById("number");
 length = document.getElementById("length");

 // When the user clicks on the password field, show the message box
Input.onfocus = function() {
    document.getElementById("message").style.display = "block";
}
Input.onblur = function() {
    document.getElementById("message").style.display = "none";
}
Input.onkeyup = function() {
  // Validate lowercase letters
  var lowerCaseLetters = /[a-z]/g;
  if(Input.value.match(lowerCaseLetters)) {  
    letter.classList.remove("invalid");
    letter.classList.add("valid");
  } else {
    letter.classList.remove("valid");
    letter.classList.add("invalid");
  }
  
  // Validate capital letters
  var upperCaseLetters = /[A-Z]/g;
  if(Input.value.match(upperCaseLetters)) {  
    capital.classList.remove("invalid");
    capital.classList.add("valid");
  } else {
    capital.classList.remove("valid");
    capital.classList.add("invalid");
  }
  // Validate numbers
  var numbers = /[0-9]/g;
  if(Input.value.match(numbers)) {  
    number.classList.remove("invalid");
    number.classList.add("valid");
  } else {
    number.classList.remove("valid");
    number.classList.add("invalid");
  }
  
  // Validate length
  if(Input.value.length >= 8) {
    length.classList.remove("invalid");
    length.classList.add("valid");
  } else {
    length.classList.remove("valid");
    length.classList.add("invalid");
  }
}

  input_aktif(false)
function input_aktif(params) {
  document.getElementById("username").disabled = params
  document.getElementById("password").disabled = params
  document.getElementById("konfirmasi").disabled = params
}

 user= '<%= session["nama"] %>'
 input_user1()
 window.userbaru = true
 username=   '<%= session["username"] %>'
    if(user=="") window.location="/login"
    document.getElementById("user").innerHTML=`<a href="#" class="d-block">${user} </a>`
    
    kosong_id_hapus()
      function kosong_id_hapus(){
        window.id_hapus=0
      }
    function kosong_id_user(){
      input_aktif(false)
        window.location.reload();
      }

  function input_user1() {
        $.ajax({
          url: '/input_user1',
          method: "get",
          dataType: "json",
          data: {},
          success: function (hasil) {
        
            vdata = []

            for (kolom of hasil) {
              aksi = `
            <div class="project-action">
                <button type="button" class="btn btn-warning btn-sm" data-toggle="card" data-target="#userr" onclick="tampil_user('${kolom.username}')">
                  <i class="fas fa-pencil-alt">
                  </i>  
                  Edit
                </button>
                <button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#notif" onclick="data_hapus('${kolom.username}')" >
                  <i class="fas fa-info-circle">
                  </i>  
                  Hapus
                </button>

            </div>
            
          `  
              isi_table = []
              isi_table.push(kolom.nama, kolom.username, gridjs.html(aksi))
              vdata.push(isi_table)
            }
      
            new gridjs.Grid({
              columns: ["Nama", "Username",""],
              data: vdata,
              pagination: {
                enabled: true,
                limit: 5
              },
             
              language: {
                
              'pagination': {
                'previous': 'Sebelumnya',
                'next': 'Selanjutnya',
                'showing': 'Menampilkan',
                'results': 'Hasil',
                'to':'Sampai',
                'of':'Dari'

                }
              },
  
            }).render(document.getElementById("table_user"));
          
          },
          error: function (hasil) {
            toastr.error(hasil.responseText)
          }
        })
      }

    function  simpan_user(userbaru) {

       window.userbaru=userbaru
       $.ajax({
         url: '/simpan_user',
         method: "POST",
         dataType: "JSON",
         data: {
          nama : document.getElementById("nama").value,
          username : document.getElementById("username").value,
          password : document.getElementById("password").value,
          konfirmasi: document.getElementById("konfirmasi").value,
          userbaru : window.userbaru
          
         },
        
         success: function (hasil) {
          toastr.success('Berhasil simpan')
            window.userbaru= false

           setTimeout(()=>{
             window.location.reload();
           },1000)
           
         },
         error: function (hasil) {
           toastr.error(hasil.responseText)
         }
     })
     }

     function  tampil_user(username) {
      window.userbaru = false
  $.ajax({
    url: '/tampil_user',
    method: "post",
    dataType: "JSON",
    data: {
   "username" : username
    },
    
    success: function (hasil) {
      input_aktif(true)
      document.getElementById("nama").value=hasil.data.nama,
      document.getElementById("username").value=hasil.data.username,
      document.getElementById("password").value=hasil.data.password,
      document.getElementById("konfirmasi").value=hasil.data.password
      console.log(window.userbaru )
    },
 
    error: function (hasil) {
      toastr.error(hasil.responseText)
     
    }
})
}

function  hapus_user(username) {
       
       $.ajax({
         url: '/hapus_user',
         method: "DELETE",
         dataType: "JSON",
         data: {
         "username" : username
         },
         success: function (hasil) {
          
           toastr.success('Berhasil dihapus')

           setTimeout(()=>{
             window.location.reload();
           },1000)
           
         },
       
         error: function (hasil) {
           toastr.error(hasil.responseText)
          
         }
     })
     }
     
  function data_hapus(n_hapus){
  console.log(n_hapus)
  window.id_hapus=n_hapus
}

function logout() {
    
    $.ajax({
      url:"/logout",
      method: "get",
      dataType: "json",
      data :{ },
      success: function (results) {
        window.location = '/login'
      },
      error : function(hasil){
        toastr.error(hasil.responseText)
      }
    })
  }

  </script>

</body>
</html>
